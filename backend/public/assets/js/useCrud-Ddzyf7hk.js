import{d as r,o as k}from"./index-CzgIJ5Um.js";function I(s){const v=r([]),n=r(!1),i=r(!1),o=r(!1),a=r({}),f=r(null),l=r(!1),d=localStorage.getItem("token"),m=()=>{const e=localStorage.getItem("user"),t=e?JSON.parse(e):null;l.value=t&&t.role==="admin"},u=async()=>{try{const e=await fetch(`/api/${s}`);e.ok&&(v.value=await e.json())}catch(e){console.error(e)}},w=async e=>{if(!l.value)return alert("Доступ запрещен. Только администратор.");if(confirm("Вы уверены?"))try{(await fetch(`/api/${s}/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${d}`}})).ok?u():alert("Ошибка удаления")}catch(t){console.error(t)}},y=(e=null)=>{if(!l.value)return alert("Доступ запрещен. Только администратор.");o.value=!!e,a.value=e?{...e}:{},s==="users"&&o.value&&(a.value.password=""),e||(s==="products"&&(a.value.is_featured=!1,a.value.rating=0),s==="categories"&&(a.value.is_active=!0,a.value.sort_order=0),s==="brands"&&(a.value.is_popular=!1),s==="users"&&(a.value.role="client")),n.value=!0},p=e=>{f.value=e,i.value=!0},h=()=>{n.value=!1,i.value=!1,f.value=null,a.value={}},$=async()=>{if(!l.value)return;const e=o.value?`/api/${s}/${a.value.id}`:`/api/${s}`,t=o.value?"PUT":"POST";try{const c=await fetch(e,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(a.value)});if(c.ok)h(),u();else{const g=await c.json();alert("Ошибка: "+(g.error||"Unknown"))}}catch(c){console.error(c)}};return k(()=>{m(),u()}),{items:v,isAdmin:l,showEditModal:n,showViewModal:i,isEdit:o,form:a,selectedItem:f,fetchItems:u,deleteItem:w,openEditModal:y,openViewModal:p,closeModals:h,saveItem:$}}export{I as u};
