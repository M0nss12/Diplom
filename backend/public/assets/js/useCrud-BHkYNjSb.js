import{d as o,q as p,o as P}from"./index-BS7-ax_o.js";function T(s){const l=o([]),f=o(!1),h=o(!1),c=o(!1),t=o({}),m=o(null),n=o(!1),i=localStorage.getItem("token"),u=o(1),d=10,w=p(()=>{if(!l.value||!Array.isArray(l.value))return[];const e=(u.value-1)*d,a=e+d;return l.value.slice(e,a)}),g=p(()=>{const e=l.value?.length||0;return Math.ceil(e/d)}),$=()=>{u.value<g.value&&u.value++},A=()=>{u.value>1&&u.value--},k=()=>{const e=localStorage.getItem("user"),a=e?JSON.parse(e):null;n.value=a&&a.role==="admin"},v=async()=>{try{const e={};i&&(e.Authorization=`Bearer ${i}`);const a=await fetch(`/api/${s}`,{headers:e});if(a.ok){const r=await a.json();l.value=Array.isArray(r)?r:r.data||[]}else console.error(`Ошибка загрузки ${s}:`,a.status)}catch(e){console.error(e)}},I=async e=>{if(!n.value)return alert("Доступ запрещен.");if(confirm("Вы уверены?"))try{(await fetch(`/api/${s}/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).ok?v():alert("Ошибка удаления")}catch(a){console.error(a)}},S=(e=null)=>{if(!n.value)return alert("Доступ запрещен.");c.value=!!e,t.value=e?{...e}:{},s==="users"&&c.value&&(t.value.password=""),e||(s==="products"&&(t.value.is_featured=!1,t.value.rating=0),s==="categories"&&(t.value.is_active=!0,t.value.sort_order=0),s==="brands"&&(t.value.is_popular=!1),s==="users"&&(t.value.role="client")),f.value=!0},y=()=>{f.value=!1,h.value=!1,m.value=null,t.value={}},E=async()=>{if(!n.value)return;const e=c.value?`/api/${s}/${t.value.id}`:`/api/${s}`,a=c.value?"PUT":"POST";try{const r=await fetch(e,{method:a,headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(t.value)});if(r.ok)y(),v();else{const M=await r.json();alert("Ошибка: "+(M.error||"Unknown"))}}catch(r){console.error(r)}};return P(()=>{k(),v()}),{items:l,paginatedItems:w,page:u,totalPages:g,nextPage:$,prevPage:A,isAdmin:n,showEditModal:f,showViewModal:h,isEdit:c,form:t,selectedItem:m,fetchItems:v,deleteItem:I,openEditModal:S,closeModals:y,saveItem:E}}export{T as u};
