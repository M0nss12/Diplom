import{g as u,l as A,o as z}from"./index-Z1tz7U2i.js";function j(s,h={}){const c=u([]),g=u(!1),p=u(!1),n=u(!1),t=u(h),w=u(null),i=u(!1),f=localStorage.getItem("token"),l=u(1),m=10,S=A(()=>{if(!c.value||!Array.isArray(c.value))return[];const e=(l.value-1)*m,a=e+m;return c.value.slice(e,a)}),y=A(()=>{const e=c.value?.length||0;return Math.ceil(e/m)}),k=()=>{l.value<y.value&&l.value++},I=()=>{l.value>1&&l.value--},E=()=>{const e=localStorage.getItem("user"),a=e?JSON.parse(e):null;i.value=a&&a.role==="admin"},d=async(e=null)=>{let a;s==="orders"&&!i.value?a="/api/orders/my":a=e||`/api/${s}`;try{const o={};f&&(o.Authorization=`Bearer ${f}`);const r=await fetch(a,{headers:o});if(r.ok){const v=await r.json();c.value=Array.isArray(v)?v:v.data||[],l.value>y.value&&(l.value=1)}else console.error(`Ошибка загрузки ${s} с URL ${a}:`,r.status,await r.text()),c.value=[]}catch(o){console.error(o)}},M=async e=>{if(!i.value)return alert("Доступ запрещен.");if(confirm("Вы уверены?"))try{(await fetch(`/api/${s}/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${f}`}})).ok?d():alert("Ошибка удаления")}catch(a){console.error(a)}},P=(e=null)=>{if(!i.value)return alert("Доступ запрещен.");n.value=!!e,t.value=e?{...e}:{...h},s==="users"&&(n.value?t.value.password="":t.value.role="client"),e||(s==="products"&&(t.value.is_featured=!1,t.value.rating=0),s==="categories"&&(t.value.is_active=!0,t.value.sort_order=0),s==="brands"&&(t.value.is_popular=!1)),g.value=!0},$=()=>{g.value=!1,p.value=!1,w.value=null,t.value={...h}},T=async()=>{if(!i.value)return;const e=n.value?`/api/${s}/${t.value.id}`:`/api/${s}`,a=n.value?"PUT":"POST",o={...t.value};s==="users"&&n.value&&o.password===""&&delete o.password;try{const r=await fetch(e,{method:a,headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify(o)});if(r.ok)$(),d();else{const v=await r.json();alert("Ошибка: "+(v.error||"Unknown"))}}catch(r){console.error(r)}};return z(()=>{E(),d()}),{items:c,paginatedItems:S,page:l,totalPages:y,nextPage:k,prevPage:I,isAdmin:i,showEditModal:g,showViewModal:p,isEdit:n,form:t,selectedItem:w,fetchItems:d,deleteItem:M,openEditModal:P,closeModals:$,saveItem:T}}export{j as u};
