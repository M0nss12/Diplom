import{_ as J,c as r,a as t,i as C,b as c,w as v,d,r as N,t as M,F as w,k as p,x as F,e as D,v as A,g as u,u as q,y as V,o as G,l as S,h as n,z as E}from"./index-Z1tz7U2i.js";const H={name:"CatalogLayout",setup(){const m=u(null),e=u([]),_=u([]),s=u(1e4),g=u(s.value),b=u(0),i=u(s.value),{totalItems:U,totalPrice:a}=q(),l=u({selectedCategory:"",selectedBrand:"",priceMin:0,priceMax:s.value,hasDiscount:"",sortValue:""}),B=u(null);E("filterEventEmitter",B);const I=o=>typeof o!="number"?o:Math.floor(o).toLocaleString("ru-RU"),j=async()=>{try{const[o,x,k]=await Promise.all([fetch("/api/categories"),fetch("/api/brands"),fetch("/api/products/max-price")]);if(o.ok&&(e.value=await o.json()),x.ok&&(_.value=await x.json()),k.ok){const y=await k.json(),P=Math.ceil(y.max_price/100)*100;s.value=P,g.value=P,l.value.priceMax===1e4&&(l.value.priceMax=P,i.value=P),b.value=l.value.priceMin}}catch(o){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø—Ü–∏–π —Ñ–∏–ª—å—Ç—Ä–∞:",o)}};V(()=>l.value.sortValue,()=>f(!1)),V(()=>l.value.selectedCategory,()=>f(!1)),V(()=>l.value.selectedBrand,()=>f(!1)),V(()=>l.value.hasDiscount,()=>f(!1));const L=o=>{if(o&&o.length>0){const x=o.map(y=>Number(y.price)).filter(y=>!isNaN(y));if(x.length===0)return;const k=Math.max(...x);g.value=Math.ceil(k/100)*100}else g.value=s.value},f=(o=!0)=>{o&&(l.value.priceMin=b.value,l.value.priceMax=i.value),B.value&&B.value("applyFilters")},O=()=>{l.value.selectedCategory="",l.value.selectedBrand="",l.value.hasDiscount="",l.value.sortValue="",l.value.priceMin=0,l.value.priceMax=s.value,b.value=0,i.value=s.value,f(!1)},R=()=>{f()};G(()=>{const o=localStorage.getItem("user");m.value=o?JSON.parse(o):null,j()});const T=S(()=>m.value&&m.value.role==="admin"),z=S(()=>m.value?m.value.username:"–ì–æ—Å—Ç—å");return E("filters",l),{isAdmin:T,username:z,categories:e,brands:_,initialMaxPrice:s,maxPrice:g,filters:l,localPriceMin:b,localPriceMax:i,updateFilterOptions:L,triggerFilterAction:f,resetFilters:O,applyFilters:R,cartItemCount:U,totalPrice:a,formatPrice:I}}},K={class:"catalog-wrapper"},Q={class:"sidebar"},W={class:"sidebar-nav"},X={class:"nav-section"},Y={key:0,class:"cart-details-wrapper"},Z={class:"sidebar-cart-count"},h={class:"sidebar-cart-price"},$={key:0,class:"nav-divider"},ee={class:"nav-section filter-section"},te={class:"form-group-compact"},se={class:"form-group-compact"},ae=["value"],le={class:"form-group-compact"},oe=["value"],ie={class:"form-group-compact"},re={class:"form-group-compact price-filter-group"},ne={class:"price-range-inputs"},ce=["placeholder"],de={class:"filter-actions mt-2"},ue={class:"catalog-content"},ve={class:"content-header"},me={class:"content-header-inner",style:{display:"flex","align-items":"center","justify-content":"flex-start",width:"100%"}},fe={class:"user-info"},pe={class:"content-body"};function ge(m,e,_,s,g,b){const i=N("router-link"),U=N("router-view");return n(),r("div",K,[t("aside",Q,[e[28]||(e[28]=t("div",{class:"sidebar-header"},[t("span",{class:"logo-icon"},"üõçÔ∏è"),t("span",null,"–ú–∞–≥–∞–∑–∏–Ω")],-1)),t("nav",W,[t("div",X,[e[16]||(e[16]=t("div",{class:"nav-divider"},null,-1)),c(i,{to:"/",class:"nav-item back-link"},{default:v(()=>[...e[8]||(e[8]=[t("span",{class:"nav-icon"},"üè†",-1),d(" –ì–ª–∞–≤–Ω–∞—è ",-1)])]),_:1}),c(i,{to:"/catalog/products",class:"nav-item"},{default:v(()=>[...e[9]||(e[9]=[t("span",{class:"nav-icon"},"üì¶",-1),d(" –¢–æ–≤–∞—Ä—ã ",-1)])]),_:1}),c(i,{to:"/cart",class:"nav-item cart-link-sidebar"},{default:v(()=>[e[10]||(e[10]=t("div",null,[t("span",{class:"nav-icon"},"üõí"),d(" –ö–æ—Ä–∑–∏–Ω–∞ ")],-1)),s.cartItemCount>0?(n(),r("div",Y,[t("span",Z,M(s.cartItemCount)+" —à—Ç.",1),t("span",h,M(s.formatPrice(s.totalPrice))+" ‚ÇΩ",1)])):C("",!0)]),_:1}),s.isAdmin?(n(),r("div",$)):C("",!0),s.isAdmin?(n(),r(w,{key:1},[c(i,{to:"/catalog/categories",class:"nav-item"},{default:v(()=>[...e[11]||(e[11]=[t("span",{class:"nav-icon"},"üìÇ",-1),d(" –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ ",-1)])]),_:1}),c(i,{to:"/catalog/brands",class:"nav-item"},{default:v(()=>[...e[12]||(e[12]=[t("span",{class:"nav-icon"},"üè∑Ô∏è",-1),d(" –ë—Ä–µ–Ω–¥—ã ",-1)])]),_:1}),c(i,{to:"/catalog/users",class:"nav-item"},{default:v(()=>[...e[13]||(e[13]=[t("span",{class:"nav-icon"},"üë•",-1),d(" –ö–ª–∏–µ–Ω—Ç—ã ",-1)])]),_:1}),c(i,{to:"/catalog/orders",class:"nav-item"},{default:v(()=>[...e[14]||(e[14]=[t("span",{class:"nav-icon"},"üìù",-1),d(" –ó–∞–∫–∞–∑—ã ",-1)])]),_:1}),c(i,{to:"/catalog/logs",class:"nav-item"},{default:v(()=>[...e[15]||(e[15]=[t("span",{class:"nav-icon"},"üìú",-1),d(" –õ–æ–≥–∏ ",-1)])]),_:1})],64)):C("",!0)]),!s.isAdmin&&m.$route.path==="/catalog/products"?(n(),r(w,{key:0},[e[27]||(e[27]=t("div",{class:"nav-divider"},null,-1)),t("div",ee,[e[26]||(e[26]=t("h4",{class:"nav-title-visible"},"üîé –§–∏–ª—å—Ç—Ä –∏ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞",-1)),t("div",te,[e[18]||(e[18]=t("label",{for:"sort-filter"},"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:",-1)),p(t("select",{id:"sort-filter","onUpdate:modelValue":e[0]||(e[0]=a=>s.filters.sortValue=a),class:"form-select"},[...e[17]||(e[17]=[t("option",{value:""},"–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1),t("option",{value:"price_asc"},"–°–Ω–∞—á–∞–ª–∞ –Ω–µ–¥–æ—Ä–æ–≥–∏–µ (‚Üë)",-1),t("option",{value:"price_desc"},"–°–Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–≥–∏–µ (‚Üì)",-1)])],512),[[F,s.filters.sortValue]])]),t("div",se,[e[20]||(e[20]=t("label",{for:"cat-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),p(t("select",{id:"cat-filter","onUpdate:modelValue":e[1]||(e[1]=a=>s.filters.selectedCategory=a),class:"form-select"},[e[19]||(e[19]=t("option",{value:""},"–í—Å–µ",-1)),(n(!0),r(w,null,D(s.categories,a=>(n(),r("option",{key:a.id,value:a.id},M(a.name),9,ae))),128))],512),[[F,s.filters.selectedCategory]])]),t("div",le,[e[22]||(e[22]=t("label",{for:"brand-filter"},"–ë—Ä–µ–Ω–¥:",-1)),p(t("select",{id:"brand-filter","onUpdate:modelValue":e[2]||(e[2]=a=>s.filters.selectedBrand=a),class:"form-select"},[e[21]||(e[21]=t("option",{value:""},"–í—Å–µ",-1)),(n(!0),r(w,null,D(s.brands,a=>(n(),r("option",{key:a.id,value:a.id},M(a.name),9,oe))),128))],512),[[F,s.filters.selectedBrand]])]),t("div",ie,[e[24]||(e[24]=t("label",{for:"discount-filter"},"–°–∫–∏–¥–∫–∏:",-1)),p(t("select",{id:"discount-filter","onUpdate:modelValue":e[3]||(e[3]=a=>s.filters.hasDiscount=a),class:"form-select"},[...e[23]||(e[23]=[t("option",{value:""},"–í—Å–µ",-1),t("option",{value:!0},"–¢–æ–ª—å–∫–æ —Å–æ —Å–∫–∏–¥–∫–æ–π",-1)])],512),[[F,s.filters.hasDiscount]])]),t("div",re,[e[25]||(e[25]=t("label",null,"–¶–µ–Ω–∞ (‚ÇΩ):",-1)),t("div",ne,[p((n(),r("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=a=>s.localPriceMin=a),placeholder:"–ú–∏–Ω",class:"form-input",key:"min"+s.maxPrice})),[[A,s.localPriceMin,void 0,{number:!0}]]),p((n(),r("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=a=>s.localPriceMax=a),placeholder:`–ú–∞–∫—Å (${s.formatPrice(s.initialMaxPrice)})`,class:"form-input",key:"max"+s.maxPrice},null,8,ce)),[[A,s.localPriceMax,void 0,{number:!0}]])])]),t("div",de,[t("button",{class:"btn btn-primary btn-sm w-100",onClick:e[6]||(e[6]=a=>s.triggerFilterAction(!0))},"–ü—Ä–∏–º–µ–Ω–∏—Ç—å"),t("button",{class:"btn btn-outline btn-sm w-100 mt-1",onClick:e[7]||(e[7]=(...a)=>s.resetFilters&&s.resetFilters(...a))},"–°–±—Ä–æ—Å–∏—Ç—å")])])],64)):C("",!0)])]),t("main",ue,[t("header",ve,[t("div",me,[t("div",fe,[e[29]||(e[29]=d("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ",-1)),t("strong",null,M(s.username),1)])])]),t("div",pe,[c(U,{filters:s.filters,categories:s.categories,brands:s.brands,maxPrice:s.initialMaxPrice,"onUpdate:items":s.updateFilterOptions,onTriggerFilter:s.applyFilters},null,8,["filters","categories","brands","maxPrice","onUpdate:items","onTriggerFilter"])])])])}const xe=J(H,[["render",ge]]);export{xe as default};
