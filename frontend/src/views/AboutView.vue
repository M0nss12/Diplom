<template>
  <div class="container animate-fade-in about-view-page">
    
    <div class="about-hero">
      <div class="hero-content">
        <h1>–û –∫–æ–º–ø–∞–Ω–∏–∏ <span class="text-primary">AutoParts Pro</span></h1>
        <p class="lead-text">
          –í–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä –≤ –º–∏—Ä–µ –∞–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–µ–π —Å {{ yearsOfOperation }}+ –ª–µ—Ç –æ–ø—ã—Ç–∞. 
          –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏ —ç–∫—Å–ø–µ—Ä—Ç–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É 24/7.
        </p>
        <router-link to="/catalog" class="btn btn-primary mt-4 btn-lg">
          –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
        </router-link>
      </div>
      <div class="hero-image-placeholder">
        <div class="icon-car">‚öôÔ∏è</div>
        <p>–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å</p>
      </div>
    </div>
    
    <div v-if="loadingStats" class="text-center p-8">
        <div class="loader"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
    </div>
    <div v-else class="stats-counter-section">
      <div v-for="(stat, index) in stats" :key="index" class="stat-item">
        <div class="stat-number-animated" :data-target="stat.value" :data-duration="2000">
          {{ stat.value.toLocaleString('ru-RU') }}
        </div>
        <div class="stat-label">{{ stat.label }}</div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title text-center">–ü–æ—á–µ–º—É –Ω–∞–º –¥–æ–≤–µ—Ä—è—é—Ç —Ç—ã—Å—è—á–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤?</h2>
      <div class="about-features-grid">
        
        <div class="feature-card-new">
          <div class="icon-wrapper">üöÄ</div>
          <h3>–û–≥—Ä–æ–º–Ω—ã–π –ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç</h3>
          <p>–ë–æ–ª–µ–µ {{ stats[1].value.toLocaleString('ru-RU') }} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏ –∏ –ø–æ–¥ –∑–∞–∫–∞–∑ –¥–ª—è –ª—é–±—ã—Ö –º–∞—Ä–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.</p>
        </div>
        
        <div class="feature-card-new">
          <div class="icon-wrapper">üîí</div>
          <h3>–ì–∞—Ä–∞–Ω—Ç–∏—è –ö–∞—á–µ—Å—Ç–≤–∞</h3>
          <p>–†–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏. –í—Å–µ —Ç–æ–≤–∞—Ä—ã —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –∏ –∏–º–µ—é—Ç –ø–æ–ª–Ω—É—é –≥–∞—Ä–∞–Ω—Ç–∏—é.</p>
        </div>
        
        <div class="feature-card-new">
          <div class="icon-wrapper">üë®‚Äçüîß</div>
          <h3>–≠–∫—Å–ø–µ—Ä—Ç–Ω–∞—è –ü–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
          <p>–ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã —Å –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º –ø–æ–º–æ–≥—É—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –Ω—É–∂–Ω—É—é –¥–µ—Ç–∞–ª—å –∏ –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É—é—Ç –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ.</p>
        </div>
        
        <div class="feature-card-new">
          <div class="icon-wrapper">üí∞</div>
          <h3>–í—ã–≥–æ–¥–Ω—ã–µ –¶–µ–Ω—ã</h3>
          <p>–ü—Ä—è–º—ã–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞–º –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ —Ü–µ–Ω—ã –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –∞–∫—Ü–∏–∏ –¥–ª—è –Ω–∞—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.</p>
        </div>
        
      </div>
    </div>

    <div class="section contacts-section">
      <h2 class="section-title text-center">–í—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ –∏ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å</h2>
      <div class="contact-cards-grid">
          
        <div class="contact-card-item">
          <div class="icon-wrapper">üìû</div>
          <h3>–ì–æ—Ä—è—á–∞—è –ª–∏–Ω–∏—è</h3>
          <p class="text-xl font-bold">{{ contacts.phone || '+7 (XXX) XXX-XX-XX' }}</p>
          <p>–ó–≤–æ–Ω–∏—Ç–µ –Ω–∞–º –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è. –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã.</p>
        </div>

        <div class="contact-card-item">
          <div class="icon-wrapper">‚è≥</div>
          <h3>–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã</h3>
          <p class="text-xl font-bold">{{ contacts.workHours || '–ü–Ω-–í—Å: 9:00 - 21:00' }}</p>
          <p>–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º, –∫–æ–≥–¥–∞ —ç—Ç–æ –Ω—É–∂–Ω–æ –≤–∞–º. –ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö.</p>
        </div>

        <div class="contact-card-item">
          <div class="icon-wrapper">üìç</div>
          <h3>–ù–∞—à –∞–¥—Ä–µ—Å</h3>
          <p class="text-xl font-bold">{{ contacts.address || '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1' }}</p>
          <p>–ü—Ä–∏–µ–∑–∂–∞–π—Ç–µ –∑–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑–æ–º –∏–ª–∏ –¥–ª—è –ª–∏—á–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.</p>
        </div>

      </div>
    </div>
    </div>
</template>

<script>
import { ref, onMounted } from 'vue'

export default {
  name: 'AboutView',
  setup() {
    const yearsOfOperation = 2024 - 2010; 
    const loadingStats = ref(true);
    const contacts = ref({}); // –ù–æ–≤—ã–π state –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    
    const stats = ref([
      { label: '–õ–µ—Ç –Ω–∞ —Ä—ã–Ω–∫–µ', value: yearsOfOperation },
      { label: '–¢–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ', value: 0 },
      { label: '–î–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤', value: 0 },
      { label: '–û—Ç–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤', value: 0 },
    ]);

    // –î–ê–ù–ù–´–ï –î–õ–Ø –ö–û–ú–ê–ù–î–´ –£–î–ê–õ–ï–ù–´ (teamMembers)
    const teamMembers = ref([]); 

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    const runCountUp = () => {
      const duration = 2000;
      document.querySelectorAll('.stat-number-animated').forEach(el => {
        const target = parseInt(el.dataset.target);
        const start = 0;
        let startTime = null;

        const step = (timestamp) => {
          if (!startTime) startTime = timestamp;
          const progress = timestamp - startTime;
          const percentage = Math.min(progress / duration, 1);
          const interpolatedValue = percentage < 0.5 ? 2 * percentage * percentage : -1 + (4 - 2 * percentage) * percentage;
          const currentValue = Math.floor(interpolatedValue * target);

          el.textContent = currentValue.toLocaleString('ru-RU');

          if (percentage < 1) {
            window.requestAnimationFrame(step);
          } else {
            el.textContent = target.toLocaleString('ru-RU');
          }
        };

        window.requestAnimationFrame(step);
      });
    };

    // –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò
    const fetchStats = async () => {
      loadingStats.value = true;
      try {
        const response = await fetch('/api/stats');
        
        if (response.ok) {
          const apiStats = await response.json();
          stats.value = [
            { label: '–õ–µ—Ç –Ω–∞ —Ä—ã–Ω–∫–µ', value: yearsOfOperation },
            { label: '–¢–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ', value: apiStats.total_products || 0 },
            { label: '–î–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤', value: apiStats.unique_customers || 0 }, 
            { label: '–û—Ç–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤', value: apiStats.shipped_orders || 0 }, 
          ];
        } else {
            stats.value[1].value = 54000;
            stats.value[2].value = 125800;
            stats.value[3].value = 380000;
        }

      } catch (error) {
        stats.value[1].value = 54000;
        stats.value[2].value = 125800;
        stats.value[3].value = 380000;
      } finally {
        loadingStats.value = false;
        setTimeout(runCountUp, 50); 
      }
    };
    
    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ó–ê–ì–†–£–ó–ö–ê –ö–û–ù–¢–ê–ö–¢–û–í
    const fetchContacts = async () => {
        try {
            const response = await fetch('/api/contacts');
            if (response.ok) {
                contacts.value = await response.json();
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:', error);
        }
    };

    onMounted(async () => {
      await Promise.all([
          fetchStats(), 
          fetchContacts() // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
      ]);
    });

    return {
      yearsOfOperation,
      stats,
      contacts, // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
      teamMembers, 
      loadingStats,
    }
  }
}
</script>

<style scoped>
/* –ü–†–ï–î–ü–û–õ–ê–ì–ê–ï–ú–´–ï –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï */
:root {
  --primary: #c0392b; /* –ö—Ä–∞—Å–Ω—ã–π */
  --primary-dark: #a5281b; 
  --text-dark: #333;
  --gray: #666;
  --gray-light: #f4f4f4;
  --white: #fff;
  --border: #ddd;
  --radius: 8px;
  --radius-small: 4px;
}

/* --- –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò –°–ï–ö–¶–ò–ô --- */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem;
}
.section {
  margin-top: 4rem;
  margin-bottom: 4rem;
}
.section-title {
  font-size: 2.2rem;
  font-weight: 700;
  color: var(--text-dark);
  margin-bottom: 2rem;
}
.text-primary {
    color: var(--primary);
}
.lead-text {
    font-size: 1.15rem;
    color: var(--gray);
    max-width: 800px;
    margin: 1rem auto 0;
}
.btn {
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-small);
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
}
.btn-primary {
    background-color: var(--primary);
    color: var(--white);
    border: 1px solid var(--primary);
}
.btn-primary:hover {
    background-color: var(--primary-dark);
    transform: translateY(-1px);
}
.btn-lg {
    font-size: 1.1rem;
}

/* --- HERO SECTION --- */
.about-hero {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: var(--gray-light);
    border-radius: var(--radius);
    padding: 3rem 2rem;
    text-align: left;
}
.hero-content {
    max-width: 60%;
}
.hero-image-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-width: 250px;
    height: 200px;
    background-color: var(--white);
    border-radius: var(--radius);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}
.icon-car {
    font-size: 4rem;
    line-height: 1;
    margin-bottom: 0.5rem;
}
.hero-image-placeholder p {
    font-weight: 600;
    color: var(--primary);
}

/* --- STATS COUNTER SECTION --- */
.stats-counter-section {
    display: flex;
    justify-content: space-around;
    gap: 1.5rem;
    margin-top: 3rem;
    padding: 2rem 0;
    text-align: center;
    background-color: var(--white);
    border-radius: var(--radius);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}
.stat-item {
    flex-basis: 25%;
}
.stat-number-animated {
    font-size: 2.8rem;
    font-weight: 800;
    color: var(--primary-dark);
    line-height: 1.1;
}
.stat-label {
    font-size: 1rem;
    color: var(--gray);
    margin-top: 0.5rem;
}

/* --- FEATURES GRID --- */
.about-features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-top: 3rem;
}

.feature-card-new {
    padding: 1.5rem;
    background-color: var(--white);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s;
}
.feature-card-new:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.icon-wrapper {
    font-size: 2rem;
    margin-bottom: 1rem;
}
.feature-card-new h3 {
    font-size: 1.25rem;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}
.feature-card-new p {
    color: var(--gray);
    font-size: 0.95rem;
}

/* --- –ù–û–í–´–ï –°–¢–ò–õ–ò: –ö–û–ù–¢–ê–ö–¢–´ –ò –î–û–°–¢–£–ü–ù–û–°–¢–¨ --- */
.contacts-section {
    background-color: #fcfcfc;
    padding: 2rem 1rem;
    border-radius: var(--radius);
}
.contact-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
    margin-top: 3rem;
}
.contact-card-item {
    background-color: var(--white);
    padding: 2rem;
    border-radius: var(--radius);
    text-align: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    border-top: 4px solid var(--primary);
}
.contact-card-item h3 {
    font-size: 1.4rem;
    color: var(--primary-dark);
    margin: 1rem 0 0.5rem;
}
.contact-card-item p {
    color: var(--gray);
    margin-bottom: 0;
}
.contact-card-item .icon-wrapper {
    background-color: var(--gray-light);
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    margin: 0 auto;
}

/* --- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å --- */
@media (max-width: 900px) {
    .about-hero {
        flex-direction: column;
        text-align: center;
        padding: 2rem 1rem;
    }
    .hero-content {
        max-width: 100%;
        margin-bottom: 1.5rem;
    }
    .stats-counter-section {
        flex-wrap: wrap;
    }
    .stat-item {
        flex-basis: 45%;
        margin-bottom: 1rem;
    }
}
@media (max-width: 500px) {
    .stat-number-animated {
        font-size: 2rem;
    }
    .contact-cards-grid {
        grid-template-columns: 1fr;
    }
}
</style>